
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Trị Viên Confessions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body style="padding: 30px 7%;">
    <h1 class="text-center pt-4">Xin chào em, hãy duyệt bài thật công tâm em nhé By <a href="=" target="_blank" class="hover-1">Phan Thanh Giản Confessions.</a></h1>
    <p class="text-center">Anh thật sự trân trọng sự cống hiến của em dành cho Fanpage. Những nỗ lực và tâm huyết của em là điều không gì có thể đền đáp xứng đáng. Cảm ơn em rất nhiều nhé!</p>
   
    <div class="controls" style="padding: 10px 0px;">
    <label for="startCode">Bắt đầu từ:</label>
    <input id="startCode" type="text" placeholder="vd: a1 hoặc #a1 hoặc 1">
    <button id="copyBtn">Copy đã chọn</button>
    <button id="selectAllBtn">Chọn tất cả</button>
    <button id="clearBtn">Bỏ chọn</button>
  </div>

  <div id="result" class="message" aria-live="polite"></div>
    <div class="container table-responsive py-5"> 
      <div id="result" class="message" aria-live="polite"></div>
<table class="table table-bordered table-hover" id="contentTable">
  <thead class="thead-dark">
      <tr>
        <th scope="col">Ngày</th>
        <th scope="col">Email</th>
        <th scope="col">Nội dung</th>
        <th scope="col">Đã đọc</th>
      </tr>
    </thead>
    <tbody>
            <!-- sẽ được fill từ Google Sheet -->
    </tbody>
</table>
 
  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbwkX0mBn5Uh0rtG2KU3wNNSVEAFmSRPu7mTtyfGFqmIcOzpAS1wMHSkCe8HL4IkuPAM/exec";

    // Load data từ Google Sheet
    fetch(SHEET_URL)
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#contentTable tbody");
        tbody.innerHTML = "";
        data.content.slice().reverse().forEach(row => {
          const tr = document.createElement("tr");
          row.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);
          });
          // thêm checkbox
          const tdCheck = document.createElement("td");
          const cb = document.createElement("input");
          cb.type = "checkbox";
          tdCheck.appendChild(cb);
          tr.appendChild(tdCheck);
          tbody.appendChild(tr);
        });
      });

    // --- Các hàm copy/select ---
    function normalizeStart(s){
      s = (s||'').trim();
      s = s.replace(/^#/, '').replace(/\.$/, '');
      const m = s.match(/^([A-Za-z]*)(\d+)$/);
      if(!m) return null;
      return {prefix: m[1] || '', number: parseInt(m[2],10)};
    }

    async function copyToClipboard(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(e){ console.warn('navigator.clipboard failed:', e); }
      }
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position = 'absolute';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        ta.setSelectionRange(0, ta.value.length);
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }catch(e){ console.error('Fallback copy failed:', e); return false; }
    }

    document.getElementById('copyBtn').addEventListener('click', async function(){
      const checkboxes = document.querySelectorAll('#contentTable tbody input[type="checkbox"]');
      const startVal = document.getElementById('startCode').value.trim();
      const norm = normalizeStart(startVal);
      if(!norm){
        alert('Định dạng mã bắt đầu không hợp lệ. Ví dụ: a1 hoặc #a1 hoặc 1');
        return;
      }
      let {prefix, number} = norm;
      const lines = [];
      checkboxes.forEach(cb=>{
        if(cb.checked){
          const row = cb.closest('tr');
          const content = (row.cells[2]?.innerText || '').trim();
          lines.push(`#${prefix}${number}. ${content}`);
          number++;
        }
      });
      if(lines.length===0){
        alert('Bạn chưa chọn hàng nào.');
        return;
      }
      const text = lines.join('. \n');
      const ok = await copyToClipboard(text);
      const resEl = document.getElementById('result');
      const prevManual = document.getElementById('manualArea');
      if(prevManual) prevManual.remove();
      if(ok){
        resEl.textContent = 'Đã copy ' + lines.length + ' dòng vào clipboard. Dán (Ctrl+V) để kiểm tra.';
      }else{
        resEl.textContent = 'Không thể copy tự động — nội dung đã hiển thị bên dưới, bạn có thể sao chép thủ công.';
        const ta = document.createElement('textarea');
        ta.id = 'manualArea';
        ta.style.width = '100%';
        ta.style.height = '120px';
        ta.value = text;
        resEl.parentNode.appendChild(ta);
      }
    });

    document.getElementById('selectAllBtn').addEventListener('click', ()=>{
      document.querySelectorAll('#contentTable tbody input[type="checkbox"]').forEach(cb=>cb.checked=true);
    });
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      document.querySelectorAll('#contentTable tbody input[type="checkbox"]').forEach(cb=>cb.checked=false);
    });
  </script>
</div>
<p class="text-center">Nhà phát triển website <a href="https://www.facebook.com/Developer.X.Ttp/" target="_blank" class="hover-1">Phong Tran </a></p>
</body>
</html>





